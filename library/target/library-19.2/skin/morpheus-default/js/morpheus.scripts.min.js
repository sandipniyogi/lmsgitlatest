(function(a){"object"!==typeof qtip&&"object"!==typeof moment&&"object"!==typeof portal||"undefined"===typeof moment||(moment.locale(portal.locale),portal.socialBullhorn=$PBJQ("#Mrphs-social-bullhorn"),portal.academicBullhorn=$PBJQ("#Mrphs-academic-bullhorn"),portal.wrapNoAlertsString=function(a){return'\x3cdiv class\x3d"portal-bullhorn-no-alerts"\x3e'+a+"\x3c/div\x3e"},portal.clearBullhornAlert=function(a,c,d){$PBJQ.get("/direct/portal/clearBullhornAlert",{id:c}).done(function(){var b=$PBJQ("#portal-bullhorn-alert-"+
c),f=1===$PBJQ(".portal-bullhorn-"+a+"-alert").length;b.remove();f&&$PBJQ(".portal-bullhorn-"+a+"-alerts").html(portal.wrapNoAlertsString(d));b=$PBJQ(".portal-bullhorn-"+a+"-alert").length;portal.setCounter(a,b)})},portal.clearAllAlerts=function(a,c){$PBJQ.ajax({url:"/direct/portal/clearAll"+a+"Alerts",cache:!1}).done(function(){$PBJQ(".portal-bullhorn-"+a.toLowerCase()+"-alerts").html(portal.wrapNoAlertsString(c));portal.setCounter(a.toLowerCase(),0)})},portal.acceptFriendRequest=function(a,c,d,
e){confirmFriendRequest(c,a);this.clearBullhornAlert(portal.SOCIAL,d,e)},portal.ignoreFriendRequest=function(a,c,d,e){ignoreFriendRequest(c,a);this.clearBullhornAlert(portal.SOCIAL,d,e)},$PBJQ(document).ready(function(){portal.socialBullhorn.qtip({suppress:!1,position:{adjust:{scroll:!1},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.academicBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(a,c){return $PBJQ.ajax({url:"/direct/portal/socialAlerts.json",
cache:!1}).then(function(a){if(a.message&&"NO_ALERTS"===a.message)return portal.wrapNoAlertsString(a.i18n.noAlerts);var b='\x3cdiv class\x3d"portal-bullhorn-social-alerts"\x3e';a.alerts.forEach(function(c){b="profile.friend.request"===c.event?b+'\x3ca href\x3d"javascript:;" class\x3d"portal-bullhorn-connectionmanager-pending"\x3e':"profile.friend.confirm"===c.event?b+'\x3ca href\x3d"javascript:;" class\x3d"portal-bullhorn-connectionmanager-current"\x3e':b+('\x3ca href\x3d"'+c.url+'"\x3e');b+='\x3cdiv id\x3d"portal-bullhorn-alert-'+
c.id+'" class\x3d"portal-bullhorn-social-alert"\x3e\x3cdiv class\x3d"portal-bullhorn-photo" style\x3d"background-image:url(/direct/profile/'+c.from+'/image/thumb)"\x3e\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-content"\x3e\x3cdiv class\x3d"portal-bullhorn-message"\x3e\x3cspan class\x3d"portal-bullhorn-display-name"\x3e'+c.fromDisplayName+"\x3c/span\x3e";b="profile.wall.item.new"===c.event?b+a.i18n.wallPost:"profile.status.update"===c.event?b+a.i18n.statusUpdate:"profile.wall.item.comment.new"===
c.event?b+a.i18n.postComment:"profile.friend.request"===c.event?b+a.i18n.friendRequest:"profile.friend.confirm"===c.event?b+a.i18n.friendConfirm:"profile.message.sent"===c.event?b+a.i18n.message:"commons.comment.created"===c.event?b+a.i18n.commentCreated:b+a.i18n.unrecognisedAlert;var d=moment.unix(c.eventDate.epochSecond).format("L LT");b+='\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-time"\x3e'+d+'\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-options"\x3e';"profile.friend.request"===c.event&&(b+=
'\x3ca href\x3d"javascript:;" onclick\x3d"portal.acceptFriendRequest(\''+c.from+"','"+c.to+"','"+c.id+"','"+a.i18n.noAlerts+"');\"\x3e"+a.i18n.accept+"\x3c/a\x3e",b+='\x3ca href\x3d"javascript:;" onclick\x3d"portal.ignoreFriendRequest(\''+c.from+"','"+c.to+"','"+c.id+"','"+a.i18n.noAlerts+"');\"\x3e"+a.i18n.ignore+"\x3c/a\x3e");b+="\x3c/div\x3e";b+='\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-clear"\x3e\x3ca href\x3d"javascript:;" onclick\x3d"portal.clearBullhornAlert(\'social\', \''+c.id+"','"+
a.i18n.noAlerts+'\');" title\x3d"'+a.i18n.clear+'"\x3e\x3ci class\x3d"fa fa-times" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e'});b+='\x3cdiv id\x3d"portal-bullhorn-clear-all"\x3e\x3ca href\x3d"javascript:;" onclick\x3d"portal.clearAllAlerts(\'Social\',\''+a.i18n.noAlerts+"');\"\x3e"+a.i18n.clearAll+"\x3c/a\x3e\x3c/div\x3e";return b+="\x3c/div\x3e"},function(a,b,f){c.set("content.text",b+": "+f)})}},events:{visible:function(a,c){$PBJQ(".portal-bullhorn-connectionmanager-pending").click(function(a){portal.connectionManager.show({state:"pending"});
c.hide()});$PBJQ(".portal-bullhorn-connectionmanager-current").click(function(a){portal.connectionManager.show();c.hide()})}}});portal.academicBullhorn.qtip({suppress:!1,position:{adjust:{scroll:!1},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.socialBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(a,c){return $PBJQ.ajax({url:"/direct/portal/academicAlerts.json",dataType:"json",cache:!1}).then(function(a){if(a.message&&
"NO_ALERTS"===a.message)return portal.wrapNoAlertsString(a.i18n.noAlerts);var b='\x3cdiv class\x3d"portal-bullhorn-academic-alerts"\x3e';a.alerts.forEach(function(c){var d=c.title,e=c.siteTitle,f="fa-bullhorn";"asn.new.assignment"===c.event||"asn.grade.submission"===c.event?f="fa-file-text":"lessonbuilder.comment.create"===c.event&&(f="fa-leanpub");b+='\x3ca href\x3d"'+c.url+'" style\x3d"text-decoration: none;"\x3e\x3cdiv id\x3d"portal-bullhorn-alert-'+c.id+'" class\x3d"portal-bullhorn-academic-alert"\x3e\x3cdiv class\x3d"portal-bullhorn-icon fa fa-stack"\x3e\x3ci class\x3d"fa fa-circle fa-stack-2x"\x3e\x3c/i\x3e\x3ci class\x3d"fa '+
f+' fa-stack-1x fa-inverse"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-content"\x3e\x3cdiv class\x3d"portal-bullhorn-message"\x3e\x3cspan class\x3d"portal-bullhorn-display-name"\x3e'+c.fromDisplayName+"\x3c/span\x3e";f="";"annc.new"===c.event||"annc.revise.availability"===c.event?f=a.i18n.announcement.replace("{0}",d).replace("{1}",e):"asn.new.assignment"===c.event?f=a.i18n.assignmentCreated.replace("{0}",d).replace("{1}",e):"asn.grade.submission"===c.event?f=a.i18n.assignmentSubmissionGraded.replace("{0}",
d).replace("{1}",e):b="commons.comment.created"===c.event?b+a.i18n.academicCommentCreated.replace("{0}",e):"lessonbuilder.comment.create"===c.event?b+a.i18n.academicLessonBuilderCommentCreate.replace("{0}",e):b+a.i18n.unrecognisedAlert;d=moment.unix(c.eventDate.epochSecond).format("L LT");b+=f+'\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-time"\x3e'+d+"\x3c/div\x3e";b+='\x3c/div\x3e\x3cdiv class\x3d"portal-bullhorn-clear"\x3e\x3ca href\x3d"javascript:;" onclick\x3d"portal.clearBullhornAlert(\'academic\', \''+
c.id+"','"+a.i18n.noAlerts+'\');" title\x3d"'+a.i18n.clear+'"\x3e\x3ci class\x3d"fa fa-times" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e'});b+='\x3cdiv id\x3d"portal-bullhorn-clear-all"\x3e\x3ca href\x3d"javascript:;" onclick\x3d"portal.clearAllAlerts(\'Academic\',\''+a.i18n.noAlerts+"');\"\x3e"+a.i18n.clearAll+"\x3c/a\x3e\x3c/div\x3e";return b+="\x3c/div\x3e"},function(a,b,f){c.set("content.text",b+": "+f)})}}})}),portal.setCounter=function(a,c){var b=$PBJQ("#Mrphs-"+
a+"-bullhorn");a="social"===a?"blue":"red";b.find(".bullhorn-counter").remove();b.append('\x3cspan class\x3d"bullhorn-counter bullhorn-counter-'+a+'"\x3e'+c+"\x3c/span\x3e")},a=function(){$PBJQ.ajax({url:"/direct/portal/bullhornCounts.json",cache:!1,data:{auto:!0}}).done(function(a){portal.failedBullhornCounts=0;0<a.academic?portal.setCounter("academic",a.academic):portal.academicBullhorn.find(".bullhorn-counter").remove();0<a.social?portal.setCounter("social",a.social):portal.socialBullhorn.find(".bullhorn-counter").remove()}).fail(function(a,
c,d){console&&console.log("Failed to get the bullhorn counts. Status: "+c);console&&console.log("FAILED ERROR: "+d);portal.failedBullhornCounts=portal.failedBullhornCounts||0;portal.failedBullhornCounts+=1;3==portal.failedBullhornCounts&&clearInterval(portal.bullhornCountIntervalId)})},portal.loggedIn&&portal.bullhorns&&portal.bullhorns.enabled&&(a(),portal.bullhornCountIntervalId=setInterval(a,portal.bullhorns.pollInterval)))})($PBJQ);$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")});
(function(a){if(portal.loggedIn){portal.connectionManager=portal.connectionManager||{};var b=Handlebars.templates["connection-manager-connection"],c=Handlebars.templates["connection-manager-searchresult"],d={},e={},f={},g={};a(function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"connection-manager",namespace:"connection-manager",callback:function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"profile-popup",
namespace:"connection-manager"})}})});var h=0,m=[],n="connections",v=0,k="";portal.connectionManager.show=function(l){var w=a("#connection-manager");w.modal({width:320});var y=a("#connection-manager-connectionsview"),A=a("#connection-manager-searchresultsview"),u=a("#connection-manager-searchresultsview-count"),E=a("#connection-manager-navbar-current \x3e span \x3e a"),q=a("#connection-manager-navbar-pending \x3e span \x3e a"),x=function(a){if(0===a)u.html(portal.i18n.tr("connection-manager","connection_manager_no_results"));
else{var b={count:a,criteria:portal.connectionManager.searchCriteria};a=1<a?portal.i18n.tr("connection-manager","connection_manager_results_count",b):portal.i18n.tr("connection-manager","connection_manager_result_count",b);u.html(a)}},F=function(){P.hide();Q.show();y.show();A.hide();E.parent().addClass("current");q.parent().removeClass("current")},t=function(){Q.hide();P.show();y.show();A.hide();q.parent().addClass("current");E.parent().removeClass("current")},G=function(c,d){d=Object.keys(e).length;
a("#connection-manager-connection-"+c).remove();1===B.children().length&&p.hide();var r=f[c];r.connected=!1;r.hideConnect=!0;r.outgoing=!0;e[c]=r;r=b(r);0===d&&(C.show().html(""),H.hide());C.append(r);I();("connections"===n||"searchresults"==n&&0===L.children().length)&&t();a("#connection-manager-cancel-button-"+c).click(M)};E.click(function(a){F()});q.click(function(a){t()});var p=a("#connection-manager-connectionsview-searchresults-wrapper"),B=a("#connection-manager-connectionsview-searchresults"),
L=a("#connection-manager-searchresultsview-results");w.click(function(a){if("connection-manager-connectionsview-searchbox"!==a.target.id){var b=p[0].getBoundingClientRect();D[0].getBoundingClientRect();(a.pageX<b.left||a.pageY<b.top||a.pageX>b.left+b.width||a.pageY>b.top+b.height)&&p.hide()}});var J=a("#connection-manager-current-connections"),Q=a("#connection-manager-current-connections-wrapper"),K=a("#connection-manager-no-current-connections-wrapper"),C=a("#connection-manager-pending-connections"),
P=a("#connection-manager-pending-connections-wrapper"),H=a("#connection-manager-no-pending-connections-wrapper"),D=a("#connection-manager-connectionsview-searchbox");D.clearSearch({callback:function(){p.hide()}});var R=a("#connection-manager-searchresultsview-searchbox");0==v&&(k=q.html(),v+=1);var S=function(c){a("#connection-manager-connection-"+c).remove();0==h&&J.html("");var f=e[c];f.outgoing=!1;f.incoming=!1;f.connected=!0;var r=b(f);J.append(r);h+=1;a("#connection-manager-remove-button-"+c).click(N);
K.hide();delete e[c];1===B.children().length&&p.hide();d[c]=f;I();F()},T=function(){var b=this.dataset.userId,c=this.dataset.displayName;a.ajax("/direct/profile/"+portal.user.id+"/confirmFriendRequest?friendId\x3d"+b,{cache:!1}).done(function(a){S(b)}).fail(function(a,b,d){console.log("ERROR: failed to confirm request from '"+c+"'. errorThrown: "+d)})},O=function(b){a(".connection-manager-connection-"+b).remove();delete e[b];1===B.children().length&&p.hide();I()},U=function(){var b=this.dataset.userId,
c=this.dataset.displayName;a.ajax("/direct/profile/"+portal.user.id+"/ignoreFriendRequest?friendId\x3d"+b,{cache:!1}).done(function(a){O(b)}).fail(function(a,b,d){console.log("ERROR: failed to ignore request from '"+c+"'. errorThrown: "+d)})},V=function(){var b=this.dataset.userId,c=this.dataset.displayName;a.ajax("/direct/profile/"+portal.user.id+"/requestFriend?friendId\x3d"+b,{cache:!1}).done(function(a){G(b,c)}).fail(function(a,b,d){console.log("ERROR: failed to request connection to '"+c+"'. errorThrown: "+
d)})},W=function(b){a("#connection-manager-connection-"+b).remove();--h;0==h&&K.show();delete d[b]},N=function(){var b=this.dataset.userId,c=this.dataset.displayName;confirm(portal.i18n.tr("connection-manager","connection_manager_remove_confirm",{displayName:c}))&&a.ajax("/direct/profile/"+portal.user.id+"/removeFriend?friendId\x3d"+b,{cache:!1}).done(function(a){W(b)}).fail(function(a,b,d){console.log("ERROR: failed to remove '"+c+"'. errorThrown: "+d)})},M=function(){var b=this.dataset.userId,c=
this.dataset.displayName;a.ajax("/direct/profile/"+b+"/ignoreFriendRequest?friendId\x3d"+portal.user.id,{cache:!1}).done(function(c){a(".connection-manager-connection-"+b).remove();delete e[b];I()}).fail(function(a,b,d){console.log("ERROR: failed to ignore request from '"+c+"'. errorThrown: "+d)})},I=function(){var a=Object.keys(e).length;0===a?(q.html(k),C.html("").hide(),H.show()):q.html(k+" ("+a+")")},X=function(l,h){a("#connection-manager-profile-popup-container .qtip").remove();var m=h?L:B;if(4>
l.length)m.html(""),h?x(0):p.hide();else{portal.connectionManager.searchCriteria=l;var k=h?b:c;a.ajax("/direct/portal/connectionsearch.json?query\x3d"+l,{cache:!1}).done(function(c){m.html("");if(0===c.length)h||p.hide();else{h||p.show();var l="";g=c;f={};g.forEach(function(a){f[a.uuid]=a});h?g.forEach(function(a,b){l+=k(a)}):g.slice(0,5).forEach(function(a,b){l+=k(a)});h&&x(g.length);m.html(l);0<m.children().length&&m.show();a(function(){h?a(".connection-manager-connect-button").click(V):profile.attachPopups(a(".profile-popup-trigger"),
{hide:!0,container:"connection-manager-profile-popup-container",callbacks:{connect:G,cancel:O,accept:S,ignore:O,remove:W}});a("#connection-manager-connectionsview-searchresults-more").click(function(c){n="searchresults";B.html("");p.hide();y.hide();A.show();R.val(portal.connectionManager.searchCriteria);D.val("");a(function(){x(g.length);var c="";g.forEach(function(a,p){a.facebookSet=a.socialNetworkingInfo.facebookUrl;a.twitterSet=a.socialNetworkingInfo.twitterUrl;a.moreResult=!0;d.hasOwnProperty(a.uuid)&&
(a.connected=!0,a.hideConnect=!0);e.hasOwnProperty(a.uuid)&&(a.connected=!1,a.hideConnect=!0,a.outgoing=e[a.uuid].outgoing,a.incoming=e[a.uuid].incoming);c+=b(a)});L.html(c);a(function(){a(".connection-manager-accept-button").click(T);a(".connection-manager-ignore-button").click(U);a(".connection-manager-connect-button").click(V);a(".connection-manager-remove-button").click(N);a(".connection-manager-cancel-button").click(M)})})});a("#connection-manager-backtoconnections-link").click(function(a){n=
"connections";A.hide();y.show();p.hide();B.html("");D.val("")})})}})}};a.ajax("/direct/profile/"+portal.user.id+"/connections.json",{cache:!1}).done(function(c){d={};h=c.length;searchUserIdFilter=[portal.user.id];J.html("");m=c;0==m.length?K.show():K.hide();c.forEach(function(a){a.facebookSet=a.socialNetworkingInfo.facebookUrl;a.twitterSet=a.socialNetworkingInfo.twitterUrl;a.current=!0;a.connected=!0;a.incoming=!1;a.hideConnect=!0;d[a.uuid]=a;J.append(b(a))});a(function(){a(".connection-manager-remove-button").click(N)})}).fail(function(a,
b,c){console.log("ERROR: failed to get current connections. errorThrown: "+c)});var Y=function(c){0==c.length?(H.show(),C.hide()):(H.hide(),C.show().html(""));c.forEach(function(a){a.hideConnect=!0;a.pending=!0;C.append(b(a));e[a.uuid]=a});0<c.length?q.html(k+" ("+c.length+")"):q.html(k);a(function(){a(".connection-manager-accept-button").click(T);a(".connection-manager-ignore-button").click(U);a(".connection-manager-cancel-button").click(M)})};a.ajax("/direct/profile/"+portal.user.id+"/incomingConnectionRequests.json",
{cache:!1}).done(function(b){e={};b.forEach(function(a){a.incoming=!0});a.ajax("/direct/profile/"+portal.user.id+"/outgoingConnectionRequests.json",{cache:!1}).done(function(a){a.forEach(function(a){a.outgoing=!0;b.push(a)});Y(b)}).fail(function(a,b,c){console.log("Failed to get outgoing requests. errorThrown: "+c)})}).fail(function(a,b,c){console.log("Failed to get incoming requests. errorThrown: "+c)});D.keyup(function(a){X(this.value,!1)});D.keydown(function(b){13==b.which&&4<=this.value.length&&
a("#connection-manager-connectionsview-searchresults-more").click()});R.keyup(function(a){X(this.value,!0)});l&&"pending"===l.state&&t()};a("#Mrphs-userNav__submenuitem--connections").click(portal.connectionManager.show)}})($PBJQ);function footerDetailsPanelEscHandler(a){27===a.keyCode&&toggleFooterDetailsPanel(a)}
function toggleFooterDetailsPanel(a){a.preventDefault();$PBJQ("#Mrphs-footer--details__panel").toggleClass("Mrphs-footer--details__panel-show");$PBJQ("#Mrphs-footer--details__panel").hasClass("Mrphs-footer--details__panel-show")?($PBJQ(document).on("keyup",footerDetailsPanelEscHandler),$PBJQ("#Mrphs-footer--details__close").focus()):($PBJQ(document).off("keyup",footerDetailsPanelEscHandler),$PBJQ("#Mrphs-footer--details__info").focus())}
$PBJQ(document).ready(function(){updateFooterTime=function(){if(1==$PBJQ("#preferredTime").length)var a=$PBJQ("#preferredTime").data("preferredtzdisplay"),b=(new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset")))).getTime()-(new Date).getTime();var c=$PBJQ("#serverTime").data("servertzdisplay"),d=(new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset")))).getTime()-(new Date).getTime();return function(){var e=new Date((new Date).getTime()+d),e=e.toUTCString().replace(/GMT/,
c).replace(/UTC/,c);$PBJQ("#serverTime").text(e);1==$PBJQ("#preferredTime").length&&(e=new Date((new Date).getTime()+b),e=e.toUTCString().replace(/GMT/,a).replace(/UTC/,a),$PBJQ("#preferredTime").text(e));setTimeout("updateFooterTime()",1E3)}}();1==$PBJQ("#serverTime").length&&updateFooterTime();$PBJQ("#Mrphs-footer--details__info").click(function(a){toggleFooterDetailsPanel(a)});$PBJQ("#Mrphs-footer--details__close").click(function(a){toggleFooterDetailsPanel(a)})});
(function(a){portal.loggedIn&&(portal.i18n=portal.i18n||{},portal.i18n.translations=portal.i18n.translations||{},portal.i18n.loadProperties=function(a){if(a.namespace){var b={resourceClass:"org.sakaiproject.i18n.InternationalizedMessages",resourceBundle:"org.sakaiproject.".concat(a.namespace).concat(".bundle.Messages"),namespace:a.namespace};a=Object.assign(b,a);a.debug&&(console.log("resourceClass: "+a.resourceClass),console.log("resourceBundle: "+a.resourceBundle),console.log("namespace: "+a.namespace));
portal.i18n.translations[a.namespace]=portal.i18n.translations[a.namespace]||{};var d=portal.locale+a.resourceClass+a.resourceBundle;null!==sessionStorage.getItem(d)?(a.debug&&console.log("Returning "+d+" from sessions storage ..."),portal.i18n.translations[a.namespace]=JSON.parse(sessionStorage[d]),a.callback&&a.callback()):(a.debug&&console.log(d+" not in sessions storage. Pulling from webservice ..."),$PBJQ.ajax({url:"/sakai-ws/rest/i18n/getI18nProperties"+portal.portalCDNQuery,cache:!0,contentType:"application/json",
data:{locale:portal.locale,resourceclass:a.resourceClass,resourcebundle:a.resourceBundle}}).done(function(b,c,g){b.split("\n").forEach(function(b){b=b.split("\x3d");2==b.length&&(portal.i18n.translations[a.namespace][b[0]]=b[1]);a.debug&&(console.log("Updated translations: "),console.log(portal.i18n.translations[a.namespace]))});sessionStorage[d]=JSON.stringify(portal.i18n.translations[a.namespace]);a.callback&&a.callback()}).fail(function(a,b,c){console.error(c)}))}else console.log("You must supply at least a namespace. Doing nothing ...")},
portal.i18n.tr=function(a,c,d){if(a&&c){var b=portal.i18n.translations[a][c];if(!b)return console.log(a+"#key "+c+" not found. Returning key ..."),c;if(void 0!=d)for(var f in d)b=b.replace("{"+f+"}",d[f]);return b}console.log("You must supply a namespace and a key.")},Handlebars.registerHelper("tr",function(a,c,d){return new Handlebars.SafeString(portal.i18n.tr(a,c,d.hash))}))})($PBJQ);
$PBJQ(document).ready(function(){$PBJQ.widget("sakai.keyboardSortable",$PBJQ.ui.sortable,{options:{keyboardHandle:!1},_create:function(){this._super();this.options.keyboardHandle=this.options.keyboardHandle||this.options.items;this._dragging=!1;this.element.on("keydown",this.options.keyboardHandle,$PBJQ.proxy(this._keydown,this));this.liveRegion=$PBJQ("\x3cdiv class\x3d'ui-helper-hidden-accessible'\x3e\x3c/div\x3e").liveregion().appendTo(document.body);this.element.find(this.options.keyboardHandle).attr({"aria-grabbed":"false",
"data-at-shortcutkeys":'{"u":"drag item up","d":"drag item down"}'}).blur($PBJQ.proxy(function(a){a=$PBJQ(a.target);this._isDragging()&&this._toggleDragMode(a,this._closestSortableNode(a))},this)).click($PBJQ.proxy(function(a){if(0>=a.clientX||void 0===a.clientX)a=$PBJQ(a.target),this._toggleDragMode(a,this._closestSortableNode(a))},this))},_keydown:function(a){if(-1!==$PBJQ.inArray(a.which,[27,38,40,68,85])&&!$PBJQ(a.target).is(":input")){a.preventDefault();var b=$PBJQ(a.target),c=this._closestSortableNode(b);
switch(a.which){case 27:this._isDragging()&&this._toggleDragMode(b,c);break;case 38:case 85:(a.ctrlKey||this._isDragging()||85===a.which)&&this._moveBackward(c,b);break;case 40:case 68:(a.ctrlKey||this._isDragging()||68===a.which)&&this._moveForward(c,b)}}},_closestSortableNode:function(a){var b=a.parentsUntil(this.element).last();b.length||(b=a);return b},_isDragging:function(){return this._dragging},_toggleDragMode:function(a,b){var c=this._isDragging();b.toggleClass("sakai-dragging",!c);c?(a.attr("aria-grabbed",
"false"),this._dragging=!1,this._notify("Drag end")):(this.element.find(this.options.keyboardHandle).attr("aria-grabbed","false"),this._dragging=!0,a.attr("aria-grabbed","true"),this._notify("drag start, Use U and D keys to move the item up and down"))},_moveBackward:function(a,b,c){$prevNode=a.prev(c);$prevNode.length&&($prevNode.insertAfter(a),this._highlightDrag(a),this._notifyPosition(a))},_moveForward:function(a,b,c){$nextNode=a.next(c);$nextNode.length&&($nextNode.insertBefore(a),this._highlightDrag(a),
this._notifyPosition(a))},_highlightDrag:function(a){this._isDragging()||(a.addClass("sakai-dragging-temp"),setTimeout(function(){a.removeClass("sakai-dragging-temp")},1E3))},_notifyPosition:function(a){a=this.element.find(this.options.items).index(a)+1;this._notify("Moved to position %s".replace("%s",a))},_notify:function(a){this.liveRegion.liveregion("instance").notify(a);this._trigger("update")}});$PBJQ.widget("sakai.liveregion",{_create:function(){this.timeout=null},notify:function(a){setTimeout($PBJQ.proxy(function(){var b=
$PBJQ("\x3cdiv aria-live\x3d'polite'\x3e\x3c/div\x3e").attr("role","status").appendTo(this.element);this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout($PBJQ.proxy(function(){b.text(a)},this),500);setTimeout($PBJQ.proxy(function(){this._clear(b)},this),1E4)},this),0)},_clear:function(a){a.remove()}})});
var selectSiteModalLinks,selectSiteLastModalInTab,dhtml_view_sites=function(){$PBJQ("#selectSiteModal").addClass("dhtml_more_tabs");$PBJQ(".more-tab").position();var a=.8*$PBJQ(window).height();dhtml_view_sites=function(){var b=$PBJQ("#selectSiteModal");b.show();if("undefined"==typeof selectSiteModalLinks||"undefined"==typeof selectSiteLastModalInTab)selectSiteModalLinks=b.find("button, a"),selectSiteLastModalInTab=b.find(".tab-box a:last");b.on("keydown",function(a){var b=!1;if(!(a.ctrlKey||a.metaKey||
a.altKey)){switch(a.which){case 27:closeDrawer();b=!0;break;case 9:if(a.shiftKey)a.target===selectSiteModalLinks[0]&&(selectSiteModalLinks[selectSiteModalLinks.length-1].focus(),b=!0);else if(a.target===selectSiteModalLinks[selectSiteModalLinks.length-1]||a.target===selectSiteLastModalInTab[selectSiteLastModalInTab.length-1])selectSiteModalLinks[0].focus(),b=!0}b&&a.preventDefault()}});if(b.hasClass("outscreen")){$PBJQ("body").toggleClass("active-more-sites");var c=$PBJQ(".view-all-sites-btn:visible"),
d=c.height()+5;if(0<c.length){c.css("z-index",1005);var e=c.offset().top-$PBJQ(window).scrollTop()+d,c=$PBJQ("body").outerWidth()-(c.offset().left+c.outerWidth());"rtl"!==$PBJQ("html").attr("dir")?b.css("top",e).css("right",c):b.css("top",e).css("left",$PBJQ("body").outerWidth()-c)}b.toggleClass("outscreen");a-=e;a-=parseInt(b.css("padding-bottom"),20);MorpheusViewportHelper.isNonPhone()&&$PBJQ("#txtSearch").focus();createDHTMLMask(dhtml_view_sites);$PBJQ(".selectedTab").bind("click",function(a){dhtml_view_sites();
return!1});$PBJQ(".tab-pane:first").focus();$PBJQ(document).trigger("view-sites-shown")}else $PBJQ("body").toggleClass("active-more-sites"),$PBJQ("#selectSiteModal").toggleClass("outscreen"),c=$PBJQ(".view-all-sites-btn"),c.css("z-index","auto"),$PBJQ("#selectSite").attr("tabindex","-1"),removeDHTMLMask(),$PBJQ("#otherSiteTools").remove(),$PBJQ(".selectedTab").unbind("click")};800>$PBJQ(window).width()&&(a*=.85);$PBJQ(".tab-pane").css("height",a);dhtml_view_sites()};
function closeDrawer(){$PBJQ("#selectSiteModal").toggleClass("outscreen");removeDHTMLMask();$PBJQ("#selectSite").attr("tabindex","-1");$PBJQ("#otherSiteTools").remove();$PBJQ(".selectedTab").unbind("click");$PBJQ(".moreSitesLink").unbind("keydown");$PBJQ(".view-all-sites-btn a:visible").length?$PBJQ(".view-all-sites-btn a").focus():$PBJQ(".js-toggle-sites-nav").focus()}
function createDHTMLMask(a){$PBJQ("body").append('\x3cdiv id\x3d"portalMask"\x3e\x26nbsp;\x3c/div\x3e');$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1E3,top:0,left:0}).attr("tabindex",-1).bind("click",function(b){a();return!1});$PBJQ("#portalMask").bgiframe()}function removeDHTMLMask(){$PBJQ("#portalMask").remove()}
function showToolMenu(a){var b=a.attr("id"),c=b.replace(/!/g,"\\!").replace(/~/g,"\\~");$PBJQ(".toolMenus").removeClass("toolMenusActive").attr("aria-expanded","false");if($PBJQ("."+c).length)$PBJQ("#otherSiteTools").remove();else{var d=$PBJQ('\x3cul id\x3d"otherSiteTools" role\x3d"menu" /\x3e').addClass(b),c="/direct/site/"+b+"/pages.json";scroll(0,0);var e=parseInt($PBJQ("#maxToolsInt").text()),f=$PBJQ("#maxToolsText").text(),g=$PBJQ('\x3cli class\x3d"otherSiteTool" \x3e\x3cspan\x3e\x3ca role\x3d"menuitem" tabindex\x3d"-1"\x3e\x3cspan class\x3d"Mrphs-toolsNav__menuitem--icon"\x3e \x3c/span\x3e\x3c/a\x3e\x3c/span\x3e\x3c/li\x3e'),
h=g.clone();h.addClass("gotosite");h.find("a").attr("href",portal.portalPath+"/site/"+b).attr("title",f).append(f);h.find("a span").addClass("icon-sakai--see-all-tools");$PBJQ.getJSON(c,function(b){$PBJQ.each(b,function(a,b){if(!b.tools[0])return!0;a<e&&(a=g.clone(),a.find("a").attr("href",b.tools[0].url).attr("title",b.title).append(b.title),a.find("a span").addClass("icon-sakai--"+b.tools[0].toolId.replace(/\./gi,"-")).addClass("otherSiteToolIcon"),b.toolpopup&&a.find("a").attr("href",b.tools[0].url+
"?sakai.popup\x3dyes").attr("onclick","window.open("+b.toolpopupurl+"); return false"),d.append(a))});b.length>e&&d.append(h.clone());$PBJQ("#otherSiteTools").remove();a.closest("li").append(d);a.closest("li").find("ul li a").first().focus();addArrowNavAndDisableTabNav($PBJQ("ul#otherSiteTools"));a.parent().find(".toolMenus").addClass("toolMenusActive").attr("aria-expanded","true")})}}
$PBJQ(document).ready(function(){function a(){$PBJQ("#txtSearch").val("");$PBJQ(".fav-sites-term, .fav-sites-entry").show();$PBJQ("#noSearchResults").hide();$PBJQ("#txtSearch").focus()}1===$PBJQ("#eid").length&&$PBJQ("#eid").focus();$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",dhtml_view_sites);$PBJQ("#show-all-sites, .view-all-sites-btn").on("click",dhtml_view_sites);var b=portal.siteTitle;b&&(portal.shortDescription&&(b=b+" ("+portal.shortDescription+")"),$PBJQ(".portletTitle h2").prepend('\x3cspan class\x3d"siteTitle"\x3e'+
b+":\x3c/span\x3e "));$PBJQ("#txtSearch").keyup(function(b){27==b.keyCode&&a();if(0<$PBJQ("#txtSearch").val().length){var c=$PBJQ("#txtSearch").val().toLowerCase();$PBJQ(".fav-sites-term, .fav-sites-entry").hide();b=$PBJQ(".fav-sites-entry").filter(function(a,b){return 0<=$PBJQ(".fav-title a span.fullTitle",b).text().toLowerCase().indexOf(c)});b.show();b.closest(".fav-sites-term").show()}0==$PBJQ("#txtSearch").val().length&&a();1>$PBJQ("#otherSiteList li:visible").length&&1>$PBJQ(".otherSitesCategorList li:visible").length&&
($PBJQ(".norecords").remove(),$PBJQ("#noSearchResults").fadeIn("slow"))});$PBJQ("#otherSiteSearchClear").on("click",function(){a()});$PBJQ("#presenceToggle").click(function(a){a.preventDefault();$PBJQ("#presenceArea").toggle()});$PBJQ(".trayPopupClose").click(function(a){a.preventDefault();$PBJQ(this).closest(".trayPopup").hide()});$PBJQ("a.tool-directurl").length&&$PBJQ("a.tool-directurl").cluetip({local:!0,arrows:!0,cluetipClass:"jtip",sticky:!0,cursor:"pointer",activation:"click",closePosition:"title",
closeText:'\x3cimg src\x3d"/library/image/silk/cross.png" alt\x3d"close"\x3e'})});
$PBJQ(document).ready(function(a){var b=!0,c=void 0,d=[],e=$PBJQ("#max-favorite-entries").text().trim(),f=!1,g=$PBJQ("#selectSite"),h=$PBJQ("#otherSitesCategorWrap");a=$PBJQ("#organizeFavorites");var m={};$PBJQ(".site-favorite-btn",h).each(function(a,b){m[$PBJQ(b).attr("data-site-id")]=$PBJQ(b).parent()});var n={favorite:{markup:'\x3ci class\x3d"site-favorite-icon site-favorite"\x3e\x3c/i\x3e'},nonfavorite:{markup:'\x3ci class\x3d"site-favorite-icon site-nonfavorite"\x3e\x3c/i\x3e'},myworkspace:{markup:'\x3ci class\x3d"site-favorite-icon site-workspace site-favorite"\x3e\x3c/i\x3e'}},
v=function(a){$PBJQ.ajax({url:"/portal/favorites/list",method:"GET",dataType:"json",success:function(p){b=p.autoFavoritesEnabled;d=p.favoriteSiteIds.filter(function(a,b){return""!=a});void 0==c&&(c=d);a(d)}})},k=function(a,b){var c=n[b];$PBJQ(a).data("favorite-state",b);"favorite"===b?$PBJQ(a).attr("title",$PBJQ("#removeFromFavoritesText").text().replace("[site]",$PBJQ(a).parent().find("span.fullTitle").text())):"nonfavorite"===b?$PBJQ(a).attr("title",$PBJQ("#addToFavoritesText").text().replace("[site]",
$PBJQ(a).parent().find("span.fullTitle").text())):$PBJQ(a).attr("title",null);$PBJQ(a).empty().append($PBJQ(c.markup))},l=function(){var a=$PBJQ(".fav-sites-entry .site-favorite",h).length;$PBJQ(".favoriteCount",g).text("("+a+")");a>e?$PBJQ(".favoriteCountAndWarning").addClass("maxFavoritesReached"):$PBJQ(".favoriteCountAndWarning").removeClass("maxFavoritesReached")},w=function(){$PBJQ(".favorites-select-all-none",h).each(function(a,b){var c=$PBJQ(b).closest(".fav-sites-term");a=c.find(".fav-sites-entry:not(.my-workspace)").length;
c=c.find(".fav-sites-entry .site-favorite").length;0==a?$PBJQ(b).hide():(c==a?($PBJQ(b).data("favorite-state","favorite"),$PBJQ(b).html(n.favorite.markup)):($PBJQ(b).data("favorite-state","nonfavorite"),$PBJQ(b).html(n.nonfavorite.markup)),$PBJQ(b).show())})},y=function(a){$PBJQ(".site-favorite-btn",h).each(function(b,c){b=$PBJQ(c).attr("data-site-id");0<$PBJQ(c).closest(".my-workspace").length?k(c,"myworkspace"):0<=$PBJQ.inArray(b,a)?k(c,"favorite"):k(c,"nonfavorite")});$PBJQ(".favorites-help-text").hide();
b?$PBJQ(".favorites-help-text.autofavorite-enabled").show():$PBJQ(".favorites-help-text.autofavorite-disabled").show();w();l();f=!0},A=function(){return $PBJQ(".site-favorite-btn",h).has(".site-favorite").map(function(){return $PBJQ(this).attr("data-site-id")}).toArray()},u=function(a){q&&(f=!1,$PBJQ(".site-favorite-btn",h).empty(),$PBJQ(".favorites-select-all-none",h).empty());a||(a=0);q&&100>a?setTimeout(function(){u(a+1)},50):v(y)},E=function(){var a;a:if(d.length!=c.length)a=!1;else{for(a=0;a<
d.length;a++)if(d[a]!=c[a]){a=!1;break a}a=!0}a?$PBJQ(".moresites-refresh-notification").remove():0<$PBJQ(".moresites-refresh-notification").length||(a=$PBJQ('\x3cdiv class\x3d"moresites-refresh-notification" /\x3e').html($PBJQ("#refreshNotificationText").html()),$PBJQ("#loginLinks").prepend(a),a.css("top",$PBJQ(".Mrphs-siteHierarchy").offset().top+"px"))},q=!1,x=[],F=function(a){for(var b;0<x.length;)b=x.shift();b?$PBJQ.ajax({url:"/portal/favorites/update",method:"POST",dataType:"json",data:{userFavorites:JSON.stringify(b)},
error:a,complete:F}):q=!1},t=function(a){if(f){a||(a=function(){});var c=A(),c=c.sort(function(a,b){return-1===d.indexOf(a)?1:-1===d.indexOf(b)?-1:d.indexOf(a)-d.indexOf(b)});x.push({favoriteSiteIds:c,autoFavoritesEnabled:b});q||(q=!0,F(a));d=c;E()}},G=function(a){if(c&&-1<c.indexOf(a)){for(var b=c.indexOf(a),e=!1,f=b-1;0<=f;f--){var l=d.indexOf(c[f]);if(0<=l&&l<b){d.splice(l+1,0,a);e=!0;break}}e||d.splice(b,0,a)}};$PBJQ(h).on("click",".site-favorite-btn",function(){var a=$PBJQ(this).attr("data-site-id"),
b=$PBJQ(this).data("favorite-state");"myworkspace"!==b&&(b="favorite"===b?"nonfavorite":"favorite","favorite"==b&&G(a),k(this,b),w(),l(),t(function(){u()}))});$PBJQ(h).on("click",".favorites-select-all-none",function(){var a=$PBJQ(this).data("favorite-state"),b=$PBJQ(this).closest(".fav-sites-term").find(".fav-sites-entry:not(.my-workspace) .site-favorite-btn"),c;c="favorite"==a?"nonfavorite":"favorite";b.each(function(a,b){k($PBJQ(b),c)});l();w();t(function(){u()})});$PBJQ(g).on("click",".tab-btn",
function(){$PBJQ(".tab-btn",g).removeClass("active").attr("aria-selected","false").attr("tabindex","-1");$PBJQ(this).addClass("active").attr("aria-selected","true").attr("tabindex","0");var a=$PBJQ(this).data("tab-target");$PBJQ(".tab-box").hide();$PBJQ(g).trigger("tab-shown",a);$PBJQ("#"+a).show()});$PBJQ(g).on("keydown",".tab-btn",function(a){32==a.keyCode&&($PBJQ(this).click(),a.preventDefault());37==a.keyCode&&($PBJQ("[aria-selected\x3dtrue]").prev().click().focus(),a.preventDefault());38==a.keyCode&&
($PBJQ("[aria-selected\x3dtrue]").prev().click().focus(),a.preventDefault());39==a.keyCode&&($PBJQ("[aria-selected\x3dtrue]").next().click().focus(),a.preventDefault());40==a.keyCode&&($PBJQ("[aria-selected\x3dtrue]").next().click().focus(),a.preventDefault())});$PBJQ(document).on("view-sites-shown",function(){u()});$PBJQ(g).on("tab-shown",function(a,c){if("organizeFavorites"===c){var f=$PBJQ("#organizeFavoritesList");f.empty();$PBJQ("#noFavoritesToShow").hide();$PBJQ("#favoritesToShow").hide();$PBJQ("#otherSiteTools").remove();
$PBJQ("#organizeFavoritesPurgatoryList").empty();$PBJQ.each(d,function(a,b){m[b]&&!$PBJQ(m[b]).hasClass("my-workspace")&&(a=m[b].clone(!1),a.addClass("organize-favorite-item").data("site-id",b),b=$PBJQ('\x3ca href\x3d"javascript:void(0);" class\x3d"fav-drag-handle"\x3e\x3ci class\x3d"fa fa-bars"\x3e\x3c/i\x3e\x3c/a\x3e'),$PBJQ(".toolMenus",a).remove(),a.append(b),f.append(a),a.show())});0==f.find("li").length?$PBJQ("#noFavoritesToShow").show():$PBJQ("#favoritesToShow").show();var l=function(){var a=
$PBJQ(".organize-favorite-item");a.removeClass("site-favorite-is-past-max");$PBJQ(".favorites-max-marker").remove();$PBJQ.each(a,function(a,b){a>=e&&$PBJQ(b).addClass("site-favorite-is-past-max");a==e&&$PBJQ(b).before($PBJQ('\x3cli class\x3d"favorites-max-marker"\x3e\x3ci class\x3d"fa fa-warning warning-icon"\x3e\x3c/i\x3e '+$PBJQ("#maxFavoritesLimitReachedText").text()+"\x3c/li\x3e"))})};l();f.keyboardSortable({items:"li:not(.favorites-max-marker)",handle:".fav-drag-handle",update:function(){l();
d=f.find(".organize-favorite-item *[data-site-id]").map(function(){return $PBJQ(this).attr("data-site-id")}).toArray();t()}});f.disableSelection();$PBJQ("#autoFavoritesEnabled").attr("aria-checked",b);$PBJQ("#organizeFavorites .onoffswitch").show()}});$PBJQ(h).on("click",".toolMenus",function(a){a.preventDefault();showToolMenu($PBJQ(this));return!1});$PBJQ(a).on("click",".site-favorite-btn",function(){if(!(0<$PBJQ(this).closest(".my-workspace").length)){var a=$PBJQ(this).parent();if(0==$PBJQ(this).closest("#organizeFavoritesList").length){var b=
$PBJQ(this).attr("data-site-id");G(b);b=d.indexOf(b);0==b?$PBJQ("#organizeFavoritesList").prepend(a):0<b?$PBJQ("#organizeFavoritesList li:nth-child("+b+")").after(a):$PBJQ("#organizeFavoritesList").append(a);a="favorite"}else $PBJQ("#organizeFavoritesPurgatoryList").append(a),a="nonfavorite";k(this,a);k(m[$PBJQ(this).attr("data-site-id")].find(".site-favorite-btn"),a);w();l();t(function(){u()})}});$PBJQ("#autoFavoritesEnabled").click(function(){$PBJQ(this).attr("aria-checked",function(a,b){return String("true"!==
b)});$PBJQ(this).trigger("change")});$PBJQ("#autoFavoritesEnabled").on("change",function(){b="true"===$PBJQ(this).attr("aria-checked");$PBJQ(".favorites-help-text").hide();b?$PBJQ(".favorites-help-text.autofavorite-enabled").show():$PBJQ(".favorites-help-text.autofavorite-disabled").show();t();return!0});$PBJQ(".otherSitesMenuClose").on("click",function(){dhtml_view_sites()})});var profile=profile||{};
(function(a){profile.requestFriend=function(b,c,d){return new Promise(function(e,f){a.ajax({url:"/direct/profile/"+b+"/requestFriend?friendId\x3d"+c,dataType:"text",cache:!1}).done(function(b,f,m){a("#profile-popup-request-button-"+c).hide();a("#profile-popup-cancel-button-"+c).show();d&&d(c);e(!0)}).fail(function(a,b,c){return f()})})};profile.confirmFriendRequest=function(b,c,d){return new Promise(function(e,f){a.ajax({url:"/direct/profile/"+b+"/confirmFriendRequest?friendId\x3d"+c,dataType:"text",
cache:!1}).done(function(b,f,m){a("#profile-popup-incoming-block-"+c).hide();a("#profile-popup-remove-button-"+c).show();d&&d(c);e(!0)}).fail(function(a,b,c){return f()})})};profile.removeFriend=function(b,c,d,e){return new Promise(function(e,g){a.ajax({url:"/direct/profile/"+b+"/removeFriend?friendId\x3d"+c,dataType:"text",cache:!1}).done(function(b,f,g){a("#profile-popup-remove-button-"+c).hide();a("#profile-popup-request-button-"+c).show();d&&d(c);e(!0)}).fail(function(a,b,c){return g()})})};profile.ignoreFriendRequest=
function(b,c,d,e){return new Promise(function(f,g){a.ajax({url:"/direct/profile/"+b+"/ignoreFriendRequest?friendId\x3d"+c,cache:!1}).done(function(h,g,n){void 0!==d&&1==d?(a("#profile-popup-cancel-button-"+b).hide(),a("#profile-popup-request-button-"+b).show(),e&&e(b)):(a("#profile-popup-incoming-block-"+c).hide(),a("#profile-popup-request-button-"+c).show(),e&&e(c));f(!0)}).fail(function(a,b,c){return g()})})};profile.attachPopups=function(b,c){if(b instanceof a){c||(c={});var d=c.hide,e=c.callbacks;
e||(e={});b.each(function(){var b=this.dataset.userId,g=a(this).find(".profile-popup-target"),g={target:0<g.length?g.eq(0):a(this),my:"top left",at:"bottom center",viewport:a(window),adjust:{method:"flipinvert none"}};c&&c.container&&(g.container=a("#"+c.container));a(this).qtip({position:g,show:{event:"click",delay:0},style:{classes:"profile-popup-qtip qtip-shadow"},hide:{event:"click unfocus"},content:{text:function(c,d){return a.ajax({url:"/direct/portal/"+b+"/formatted",cache:!1}).then(function(a){return a},
function(a,b,c){d.set("content.text",b+": "+c)})}},events:{visible:function(c,f){a("#profile-popup-request-button-"+b).off("click").on("click",function(a){profile.requestFriend(portal.user.id,b,e.connect).then(function(){d&&f.hide()})});a("#profile-popup-cancel-button-"+b).off("click").on("click",function(a){profile.ignoreFriendRequest(b,portal.user.id,!0,e.cancel).then(function(){d&&f.hide()})});a("#profile-popup-accept-button-"+b).off("click").on("click",function(a){profile.confirmFriendRequest(portal.user.id,
b,e.accept).then(function(){d&&f.hide()})});a("#profile-popup-ignore-button-"+b).off("click").on("click",function(a){profile.ignoreFriendRequest(portal.user.id,b,!1,e.ignore).then(function(){d&&f.hide()})});a("#profile-popup-remove-button-"+b).off("click").on("click",function(a){profile.removeFriend(portal.user.id,b,e.remove).then(function(){d&&f.hide()})})}}})})}else console.log("profile.attachPopups takes a jQuery object array, from a selector")}})($PBJQ);
function publishSite(a){$PBJQ.ajax({type:"POST",data:"published\x3dtrue",url:"/direct/site/"+a+"/edit",success:function(){location.reload()}})}function quickLinksNavEscHandler(a){27===a.keyCode&&toggleQuickLinksNav(a)}
function toggleQuickLinksNav(a){a.preventDefault();$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")||toggleUserNav(a);$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden");$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden")?($PBJQ(".quicklinks-dropdown-overlay").remove(),$PBJQ("body").css("overflow-y","visible"),$PBJQ(document).off("keyup",quickLinksNavEscHandler)):(a=$PBJQ('\x3cdiv class\x3d"quicklinks-dropdown-overlay" /\x3e'),a.on("click",function(a){toggleQuickLinksNav(a)}),
$PBJQ("body").prepend(a),$PBJQ("body").css("overflow-y","hidden"),$PBJQ(document).on("keyup",quickLinksNavEscHandler),$PBJQ(".tab-box").css("max-height",window.innerHeight-$PBJQ("#selectQuickLink").offset().top-14))}$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav);$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav);
$PBJQ(document).ready(function(){15<$PBJQ("#reorder-list li").size()-1&&($PBJQ(".grabHandle").show(),$PBJQ("#inputFieldMessage").show(),$PBJQ("#inputKbdMessage").remove());$PBJQ("#reorder-list li").each(function(a){$PBJQ("#lastMoveArrayInit").append($PBJQ(this).attr("id")+" ");$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")});$PBJQ('input[id^\x3d"index"]').click(function(a){a.stopPropagation()});$PBJQ('input[id^\x3d"index"]').bind("keypress",function(a){return 13==(a.charCode||a.keyCode)?
!1:!0});$PBJQ("#undo-all").click(function(a){var b;b=$PBJQ.trim($PBJQ("#lastMoveArrayInit").text()).split(" ");for(z in b)thisRow=document.getElementById(b[z]),$PBJQ(thisRow).appendTo("#reorder-list");a.preventDefault();registerChange();$PBJQ("#undo-all").hide();$PBJQ("#undo-all-inact").show();$PBJQ("#undo-last-inact").show();$PBJQ("#undo-last").hide()});$PBJQ("#undo-last").click(function(a){var b;b=$PBJQ.trim($PBJQ("#lastMoveArray").text()).split(" ");for(z in b)thisRow=document.getElementById(b[z]),
$PBJQ(thisRow).appendTo("#reorder-list");b=$PBJQ.trim($PBJQ("#lastItemMoved").text());b=$PBJQ("li:eq("+b.substr(20)+")");$PBJQ(b).addClass("recentMove");a.preventDefault();registerChange("notfluid",b);$PBJQ("#undo-last-inact").fadeIn("slow");$PBJQ("#undo-last").hide()});$PBJQ('input[id^\x3d"index"]').change(function(){var a=this;preserveStatus();var b=parseInt($PBJQ(this).siblings('input[id^\x3d"holder"]').attr("value")),c=parseInt(this.value);if(isNaN(c)||c>$PBJQ('input[id^\x3d"index"]').size())return c=
$PBJQ("#failedValidMessage").text(),$PBJQ("#messageHolder").text(c.replace("#",$PBJQ('input[id^\x3d"index"]').size())),$PBJQ(".orderable-selected").removeClass("orderable-selected"),$PBJQ("#messageHolder").removeClass("messageSuccess"),$PBJQ("#messageHolder").addClass("messageValidation"),c=$PBJQ(a).position(),$PBJQ("#messageHolder").css({position:"absolute",height:"1.3em",top:c.top,left:55}),$PBJQ("#messageHolder").fadeIn("slow"),$PBJQ("#messageHolder").animate({opacity:1},2E3,function(){$PBJQ(a).val(b);
a.focus();a.select()}),$PBJQ("#messageHolder").fadeOut("slow"),$PBJQ(this).parents("li").addClass("orderable-selected"),null;var d=$PBJQ('input[id^\x3d"index"]');$PBJQ("#undo-last").fadeIn("slow");$PBJQ("#undo-last-inact").hide();$PBJQ("#undo-all").fadeIn("slow");$PBJQ("#undo-all-inact").hide();"1"===c?$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value\x3d"+c+"]").parents("li")):c==d.length?$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value\x3d"+
c+"]").parents("li")):c>b?$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value\x3d"+c+"]").parents("li")):$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value\x3d"+c+"]").parents("li"));registerChange("notfluid",$PBJQ(this).parents("li"))});return $PBJQ("#reorder-list").keyboardSortable({items:"li:not(.notsortable)",start:function(a,b){preserveStatus(b)},
update:function(a,b){registerChange(a,b)}})});
var registerChange=function(a,b){$PBJQ("#reorder-list li").size();"notfluid"!==a&&(b=$PBJQ("li[aria-selected\x3d'true']"));$PBJQ("#lastItemMoved").text($PBJQ(b).attr("id"));$PBJQ(b).addClass("recentMove");$PBJQ(b.prevAll("li").length+1);var c=$PBJQ('input[id^\x3d"index"]'),d=$PBJQ('input[id^\x3d"holder"]');a=$PBJQ("select.selectSet");for(var e=0;e<c.length;e+=1)$PBJQ(c[e]).attr("value",e+1).val(e+1);for(c=0;c<d.length;c+=1)$PBJQ(d[c]).attr("value",c+1).val(c+1);for(d=0;d<a.length;d+=1)$PBJQ(a[d]).val(d+
1),$PBJQ(a[d]).find("option").removeAttr("selected"),$PBJQ(a[d]).find("option[value\x3d"+(d+1)+"]").attr("selected","selected");$PBJQ("#undo-last").fadeIn("slow");$PBJQ("#undo-last-inact").hide();$PBJQ("#undo-all").fadeIn("slow");$PBJQ("#undo-all-inact").hide();$PBJQ(b).animate({opacity:1},2E3,function(){$PBJQ(b).removeClass("recentMove")})},preserveStatus=function(a){$PBJQ("#lastMoveArray").text("");$PBJQ("#reorder-list li").each(function(a){void 0!==$PBJQ(this).attr("id")&&"undefined_avatar"!==
$PBJQ(this).attr("id")&&$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")})};function toggleToolsNav(a){a&&a.preventDefault();$PBJQ("body").toggleClass("toolsNav--displayed");$PBJQ("body").hasClass("toolsNav--displayed")?createDHTMLMask(toggleToolsNav):removeDHTMLMask()}
$PBJQ(document).ready(function(){function a(){function a(){$PBJQ("#roleSwitchDropDown").is(".open")&&$PBJQ("#roleSwitchDropDownToggle").trigger("click")}function c(b){return 27==b.keyCode?(a(),!1):!0}$PBJQ("#roleSwitchDropDownToggle").attr("aria-hidden","false").attr("aria-haspopup","true");$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true");$PBJQ("#roleSwitchDropDownToggle").click(function(){$PBJQ("#roleSwitchDropDown").css("right",$PBJQ(window).width()-20-($PBJQ("#roleSwitchDropDownToggle").offset().left+
$PBJQ("#roleSwitchDropDownToggle").width()));$PBJQ("#roleSwitchDropDown").toggleClass("open");$PBJQ("#roleSwitchDropDown").is(".open")?($PBJQ("#roleSwitchDropDown").attr("aria-hidden","false"),$PBJQ(document.body).prepend('\x3cdiv class\x3d"user-dropdown-overlay"\x3e\x3c/div\x3e'),$PBJQ(".user-dropdown-overlay").on("click",function(){a()}),$PBJQ(document.body).on("keyup",c),setTimeout(function(){$PBJQ("#roleSwitchDropDown").find("a, :input").focus()})):($PBJQ("#roleSwitchDropDown").attr("aria-hidden",
"true"),$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document.body).off("keyup",c),$PBJQ("#roleSwitchDropDownToggle").focus())})}$PBJQ("#roleSwitchSelect").on("change",function(){""!==$PBJQ("option:selected",this).text()?document.location=$PBJQ("option:selected",this).val()+"#roleSwitch":$PBJQ(this)[0].selectedIndex=0});MorpheusViewportHelper.isPhone()?a():$PBJQ("#roleSwitch").addClass("menu-not-setup")});$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);
var sessionId="current",sessionTimeOut,timeoutDialogEnabled=!1,timeoutDialogWarningTime,timeoutLoggedoutUrl,timeoutPortalPath;$PBJQ(document).ready(function(){portal.loggedIn&&portal.timeoutDialog&&setTimeout("setup_timeout_config();",6E4)});
var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled;timeoutDialogWarningTime=portal.timeoutDialog.seconds;timeoutLoggedoutUrl=portal.loggedOutUrl;timeoutPortalPath=portal.portalPath;1==timeoutDialogEnabled&&(poll_session_data(),fetch_timeout_dialog())},poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto\x3dtrue\x26_\x3d"+(new Date).getTime(),dataType:"json",success:function(a){a.maxInactiveInterval*=1E3;a.active&&null!=a.userId&&
a.lastAccessedTime+a.maxInactiveInterval>a.currentTime?(a=a.lastAccessedTime+a.maxInactiveInterval-a.currentTime,a<1E3*timeoutDialogWarningTime?(min=Math.round(a/6E4),show_timeout_alert(min),clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",6E4)):(clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",a-1E3*timeoutDialogWarningTime))):null==a.userId?location.href=timeoutLoggedoutUrl:sessionTimeOut=setTimeout("poll_session_data()",1E4)},error:function(a,
b,c){}})};function keep_session_alive(){dismiss_session_alert();$PBJQ.get(timeoutPortalPath)}var dismiss_session_alert=function(){removeDHTMLMask();$PBJQ("#timeout_alert_body").remove()},timeoutDialogFragment;function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto\x3dtrue",cache:!0,dataType:"text",success:function(a){timeoutDialogFragment=a},error:function(a,b,c){timeoutDialogEnabled=!1}})}
function show_timeout_alert(a){timeoutDialogEnabled&&($PBJQ("#portalMask").get(0)||(createDHTMLMask(dismiss_session_alert),$PBJQ("#portalMask").css("z-index",1E3)),$PBJQ("#timeout_alert_body").get(0)?$PBJQ("#timeout_alert_body span").html(a):(a=timeoutDialogFragment.replace("{0}",a),$PBJQ("body").append(a)))}
function toggleShortUrlOutput(a,b,c){$PBJQ(b).is(":checked")?$PBJQ.ajax({url:"/direct/url/shorten?path\x3d"+encodeURI(a),dataType:"text",success:function(a){$PBJQ("."+c).val(a)}}):$PBJQ("."+c).val(a)}
$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(a){var b=$PBJQ(this).position(),c=$PBJQ(this).siblings(".Mrphs-directUrl");c.toggleClass("active").css({left:b.left+"px"});c.attr("aria-expanded","true");c.find("[tabindex]").first().focus();a.preventDefault()});$modal_container=$PBJQ(".Mrphs-directUrl");$modal_container.each(function(a){var b=$PBJQ(this).find("[tabindex]");b.first().on("keydown",function(a){if(9===a.keyCode&&a.shiftKey)return b.last().focus(),
a.preventDefault(),!1});b.last().on("keydown",function(a){if(9===a.keyCode&&!a.shiftKey)return b.first().focus(),a.preventDefault(),!1})});$modal_container.last().on("keypress",function(a){if(9===a.keyCode())return console.log("keypress:: primero"),$modal_container.fist().focus(),a.preventDefault(),!1});$PBJQ(".Mrphs-directUrl .dropDown_close").on("click keypress",function(a){var b=$PBJQ(this).parent();b.toggleClass("active");b.removeAttr("aria-expanded");$PBJQ('.Mrphs-toolTitleNav__link--directurl[rel\x3d"#'+
b.attr("id")+'"]').focus();a.preventDefault()})});var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var a=$PBJQ(this).attr("href");$PBJQ(a).attr("tabindex","-1").focus()})};
$PBJQ(document).ready(function(){var a=0;$PBJQ(document).scroll(function(b){b=$PBJQ(this).scrollTop();if(b>a&&90<b)$PBJQ(".Mrphs-topHeader").addClass("moving"),$PBJQ(".Mrphs-siteHierarchy").addClass("moving"),$PBJQ(".Mrphs-toolsNav__title--current-site").addClass("moving"),$PBJQ(".Mrphs-skipNav__menu").addClass("moving"),$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").addClass("moving");else if(90<b||0==b)$PBJQ(".Mrphs-topHeader").removeClass("moving"),$PBJQ(".Mrphs-siteHierarchy").removeClass("moving"),
$PBJQ(".Mrphs-toolsNav__title--current-site").removeClass("moving"),$PBJQ(".Mrphs-skipNav__menu").removeClass("moving"),$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").removeClass("moving");a=b})});
var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible");$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible");$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked");$PBJQ(".sitenav-dropdown-overlay").remove()},buildDropdownMenu=function(a,b,c){var d='\x3cul class\x3d"Mrphs-sitesNav__submenu" role\x3d"menu"\x3e',e=parseInt($PBJQ("#linkNav").attr("data-max-tools-int")),f=$PBJQ("#linkNav").attr("data-max-tools-anchor"),
g='\x3cli class\x3d"Mrphs-sitesNav__submenuitem Mrphs-sitesNav__submenuitem__gotosite"\x3e\x3ca tabindex\x3d"-1" role\x3d"menuitem" href\x3d"'+portal.portalPath+"/site/"+b+'" title\x3d"'+f+'"\x3e\x3cspan class\x3d"toolMenuIcon icon-sakai--see-all-tools"\x3e\x3c/span\x3e'+f+"\x3c/a\x3e\x3c/li\x3e";b="/direct/site/"+b+"/pages.json";var h=window.location.pathname.split("/").pop();$PBJQ.ajax({url:b,dataType:"json",success:function(b){$PBJQ.each(b,function(a,b){if(b.tools&&!(0>=b.tools.length)){var c=
"";h==b.tools[0].id&&(c=" is-current");a<=e&&(d+=(b.toolpopup?'\x3cli class\x3d"Mrphs-sitesNav__submenuitem" \x3e\x3ca tabindex\x3d"-1" class\x3d"Mrphs-sitesNav__submenuitem-link" role\x3d"menuitem" href\x3d"{{tool_url}}?sakai.popup\x3dyes" title\x3d"{{item_title}}" onclick\x3d"window.open(\'{{item_toolpopupurl}}\');"\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-icon"\x3e\x3cspan class\x3d"toolMenuIcon icon-sakai--{{icon}}"\x3e\x3c/span\x3e\x3c/span\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-title"\x3e{{item_title}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e':
'\x3cli class\x3d"Mrphs-sitesNav__submenuitem{{is_current}}"\x3e\x3ca tabindex\x3d"-1" class\x3d"Mrphs-sitesNav__submenuitem-link" role\x3d"menuitem" href\x3d"{{tool_url}}" title\x3d"{{item_title}}"\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-icon"\x3e\x3cspan class\x3d"toolMenuIcon icon-sakai--{{icon}}"\x3e\x3c/span\x3e\x3c/span\x3e  \x3cspan class\x3d"Mrphs-sitesNav__submenuitem-title"\x3e{{item_title}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e').replace(/{{tool_url}}/g,b.tools[0].url).replace(/{{item_title}}/g,
b.title).replace(/{{item_toolpopupurl}}/g,b.toolpopupurl).replace(/{{icon}}/g,b.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,c))}});b.length-1>e&&(d+=g);d+="\x3c/ul\x3e";d=$PBJQ(d);a.append(d);addArrowNavAndDisableTabNav(d);c(d)},error:function(a,b,c){}})},setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){27==a.keyCode&&closeAllDropdownMenus()})});$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu \x3e li.Mrphs-sitesNav__menuitem \x3e a",
function(a){40==a.keyCode?(a.preventDefault(),a=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown"),a.data("clicked")||(a.data("clicked",!0),a.trigger("click"))):27==a.keyCode&&(a.preventDefault(),closeAllDropdownMenus())});$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(a){a.preventDefault();a=$PBJQ(a.target);var b=a.parent(".Mrphs-sitesNav__menuitem"),c=b.hasClass("dropdown-is-visible");closeAllDropdownMenus();if(!c){var d=$PBJQ(this),c=function(a){d.addClass("is-clicked");
b.addClass("dropdown-is-visible");a.addClass("is-visible");b.find("li a").first().focus();a=$PBJQ('\x3cdiv class\x3d"sitenav-dropdown-overlay" /\x3e');a.on("click",function(a){closeAllDropdownMenus()});$PBJQ("body").prepend(a);d.removeData("clicked")};b.find("ul").length?c(b.find("ul")):buildDropdownMenu(b,a.attr("data-site-id"),c)}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")})};
function addArrowNavAndDisableTabNav(a){a.find("li a").attr("tabindex","-1").keydown(function(b){var c=$PBJQ(b.target);if(40==b.keyCode){b.preventDefault();b=c.closest("li").next();if(0===b.length||0==b.find("a").length)b=a.find("li").first();a.find("li a").attr("tabindex","-1");b.find("a").focus().attr("tabindex","0")}else 38==b.keyCode?(b.preventDefault(),b=c.closest("li").prev(),0===b.length&&(b=a.find("a").closest("ul")),a.find("li a").attr("tabindex","-1"),b.find("a").focus().attr("tabindex",
"0")):9==b.keyCode&&closeAllDropdownMenus()})}portal=portal||{};void 0===portal.toolsCollapsed&&(portal.toolsCollapsed=!1);portal.updateToolsCollapsedPref=function(a){portal.user.id&&$PBJQ.ajax("/direct/userPrefs/updateKey/"+portal.user.id+"/sakai:portal:sitenav?toolsCollapsed\x3d"+a,{method:"PUT",cache:!1})};
portal.toggleMinimizeNav=function(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed");$PBJQ("#subSites.floating").css({display:"none"});var a=$PBJQ(this);a.toggleClass("min max").parent().toggleClass("min max");portal.toolsCollapsed?(portal.updateToolsCollapsedPref(!1),portal.toolsCollapsed=!1,a.attr("aria-pressed",!1)):(portal.updateToolsCollapsedPref(!0),portal.toolsCollapsed=!0,a.attr("aria-pressed",!0))};$PBJQ("#toolsNav-toggle-li button").on("click",portal.toggleMinimizeNav);
$PBJQ(document).ready(function(){$PBJQ("#toggleSubsitesLink").click(function(a){a=$PBJQ(this);"block"==$PBJQ("#subSites").css("display")?($PBJQ("#subSites").hide(),$PBJQ("#subSites").removeClass("floating")):(a=a.position(),a=-1*($PBJQ("#toolMenu").height()-a.top),a=MorpheusViewportHelper.isPhone()?{display:"block",top:0,overflow:"hidden"}:{display:"block",left:$PBJQ("#toolMenu").width()+7+"px",top:a+"px"},$PBJQ("#subSites").css(a),$PBJQ("#subSites").addClass("floating"),$PBJQ("#subSites").find("li a").first().focus(),
240>$PBJQ("#toggleSubsitesLink").position().top&&$PBJQ("#subSites.floating").addClass("ontop"))})});
function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:!1,success:function(a){var b=$PBJQ("#presenceIframe");b.html(a);a=$PBJQ("#presenceCount");b.is(":empty")?(a.html(" "),a.removeClass("present").addClass("empty"),location.reload()):(b=b.find(".listUser").length,1<b?(a.html(b+""),a.removeClass("empty").addClass("present")):(1==b?$PBJQ("#presenceCount").html(b+""):$PBJQ("#presenceCount").html(" "),a.removeClass("present").addClass("empty")),b=$PBJQ(".nav-selected .icon-sakai-chat").attr("href"),
$PBJQ("#presenceIframe .presenceList div.inChat span").wrap('\x3ca href\x3d"'+b+'"\x3e\x3c/a\x3e'),sakaiLastPresenceTimeOut=setTimeout("updatePresence()",3E4))},error:function(a,b){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",6E4)}})}function userNavEscHandler(a){27===a.keyCode&&toggleUserNav(a)}
function toggleUserNav(a){a.preventDefault();$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden");$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")?($PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document).off("keyup",userNavEscHandler)):(a=$PBJQ('\x3cdiv class\x3d"user-dropdown-overlay" /\x3e'),a.on("click",function(a){toggleUserNav(a)}),$PBJQ("body").prepend(a),$PBJQ(document).on("keyup",userNavEscHandler))}
$PBJQ("#loginLink1").click(function(a){""===$PBJQ(this).attr("data-warning")||confirm($PBJQ(this).attr("data-warning"))||a.preventDefault()});$PBJQ(".js-toggle-user-nav a#loginUser \x3e .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);
$PBJQ(".Mrphs-userNav__pic-changer").on("click",function(a){function b(){n.find(".modal-body .alert").hide();$PBJQ.ajax("/direct/profile-image/remove",{data:{sakai_csrf_token:sakai_csrf_token},type:"POST",dataType:"json",success:function(a,b,c){"SUCCESS"==a.status?(g(),$PBJQ("#cropToolbar").hide()):$PBJQ("#remove-error").show()}})}function c(){var a=$PBJQ("#cropToolbar").show();portal.pictureToolbarSetup||($PBJQ(".profile-image-zoom-in",a).on("click",function(){k.find("\x3e img").cropper("zoom",.1)}),
$PBJQ(".profile-image-zoom-out",a).on("click",function(){k.find("\x3e img").cropper("zoom",-.1)}),$PBJQ(".profile-image-pan-up",a).on("click",function(){k.find("\x3e img").cropper("move",0,-10)}),$PBJQ(".profile-image-pan-down",a).on("click",function(){k.find("\x3e img").cropper("move",0,10)}),$PBJQ(".profile-image-pan-left",a).on("click",function(){k.find("\x3e img").cropper("move",10,0)}),$PBJQ(".profile-image-pan-right",a).on("click",function(){k.find("\x3e img").cropper("move",-10,0)}),$PBJQ(".profile-image-rotate",
a).on("click",function(){k.find("\x3e img").cropper("clear");k.find("\x3e img").cropper("rotate",90);k.find("\x3e img").cropper("crop")}),portal.pictureToolbarSetup=!0)}function d(a){k.show();k.find("\x3e img").cropper("clear");k.find("\x3e img").cropper("replace",a);v.removeProp("disabled");c()}function e(){$PBJQ.getJSON("/direct/profile-image/details?_\x3d"+(new Date).getTime(),function(a){"SUCCESS"!=a.status||a.isDefault||(d(a.url+"?_\x3d"+(new Date).getTime()),$PBJQ(".remove-profile-image").on("click",
function(){b()}));sakai_csrf_token=a.csrf_token})}function f(){return new Promise(function(a){a(k.find("\x3e img").cropper("getCroppedCanvas",{width:200,height:200}).toDataURL())})}function g(){var a=$PBJQ("#loginUser \x3e .Mrphs-userNav__submenuitem--profilepicture"),b=a.parent();a.detach();var c="background-image: url(/direct/profile/"+portal.user.id+"/image/thumb?"+(new Date).getTime()+")";a.attr("style",c);b.prepend(a);a=$PBJQ(".Mrphs-userNav__submenuitem--profilelink \x3e .Mrphs-userNav__submenuitem--profilepicture");
b=a.parent();a.detach();a.attr("style",c);b.prepend(a);$PBJQ("#profileImageUpload").modal("hide")}function h(a){n.find(".modal-body .alert").hide();$PBJQ.ajax("/direct/profile-image/upload",{data:{sakai_csrf_token:sakai_csrf_token,base64:a},type:"POST",dataType:"json",success:function(a,b,c){"SUCCESS"==a.status?g():$PBJQ("#upload-error").show()}})}var m=$PBJQ(this);if(!window.FileReader||!$PBJQ.fn.modal)return $PBJQ(m.data("profileLink")).trigger("click"),!0;a.preventDefault();a.stopImmediatePropagation();
var n=$PBJQ("#profileImageUpload");n.on("shown.bs.modal",function(){e()});n.modal({width:320});$PBJQ("#remove-error").hide();$PBJQ("#upload-error").hide();var v=n.find("#save");a=$PBJQ("#file");var k=$PBJQ("#cropme").hide();k.find("\x3e img").cropper({aspectRatio:1,checkCrossOrigin:!1,guides:!0,minContainerWidth:300,minContainerHeight:300,autoCropArea:1,viewMode:1,dragMode:"move"});a.on("change",function(){$PBJQ(this);if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(a){d(a.target.result)};
a.readAsDataURL(this.files[0])}else throw"Browser does not support FileReader";});v.on("click",function(a){f().then(function(a){h(a.replace(/^data:image\/(png|jpg);base64,/,""))})});return!1});var header=$PBJQ(".Mrphs-topHeader"),currentHeaderWidth=-1;
$PBJQ(document).ready(function(){$PBJQ(header).data("sticked",!1);0<$PBJQ(".Mrphs-hierarchy--parent-sites").length&&800>=$PBJQ(window).width()&&$PBJQ("#content").css("margin-top",parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(!0)+"px");$PBJQ(window).resize(function(){currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width()});$PBJQ(window).scroll(function(){var a=!0===$PBJQ(document).height()-$PBJQ(window).height()>$PBJQ(header).height();
0<$PBJQ(window).scrollTop()?!1===$PBJQ(header).data("sticked")&&!0===a&&($PBJQ(header).data("sticked",!0),$PBJQ(".Mrphs-mainHeader").addClass("is-fixed")):($PBJQ(".Mrphs-mainHeader").removeClass("is-fixed"),$PBJQ(header).data("sticked",!1))});currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width();$PBJQ(".Mrphs-headerLogo").on("click",function(){document.body.scrollTop=0;document.body.scrollLeft=0;$PBJQ(window).trigger("scroll")})});
function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(a,b,c){a=a?a:0;b&&(!a||a>b)&&(a=b);return c&&(!a||a>c)?c:a}
$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){$PBJQ(this).prop("disabled")&&$PBJQ(this).parent("label").addClass("disabled")});$PBJQ(document).keyup(function(a){27==a.keyCode&&($PBJQ("#selectSiteModal").hasClass("outscreen")||$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click"),$PBJQ(".Mrphs-directUrl__dropDown").each(function(){$PBJQ(this).hasClass("active")&&$PBJQ(this).find(".dropDown_close").trigger("click")}),$PBJQ(".fip-icon-up-dir").trigger("click"),
$PBJQ(".navigatePanelControls .close").trigger("click"))})});var MorpheusViewportHelper={isPhone:function(){return $PBJQ("#Mrphs-viewport-helpers .phone").is(":visible")},isTablet:function(){return $PBJQ("#Mrphs-viewport-helpers .tablet").is(":visible")},isDesktop:function(){return $PBJQ("#Mrphs-viewport-helpers .desktop").is(":visible")},isNonPhone:function(){return(this.isDesktop()||this.isTablet())&&!this.isPhone()}};
$PBJQ(document).ready(function(){1==$PBJQ("#loginLink2").length&&$PBJQ("#loginLink2").click(function(a){$PBJQ("body").append('\x3cdiv id\x3d"Mrphs-xlogin-container" /\x3e');$PBJQ("#Mrphs-xlogin-container").load("/portal/xlogin #Mrphs-xlogin",function(){$PBJQ("#Mrphs-xlogin-container").addClass("loaded");$PBJQ("#Mrphs-xlogin").addClass("loadedByAjax");$PBJQ("#eid").focus()});$PBJQ(".Mrphs-portalWrapper").addClass("blurry");$PBJQ("body").append('\x3cdiv id\x3d"loginPortalMask" /\x3e');$PBJQ("#loginPortalMask").bgiframe();
$PBJQ("#loginPortalMask").click(function(){$PBJQ("#loginPortalMask").remove();$PBJQ("#Mrphs-xlogin-container").remove();$PBJQ(".Mrphs-portalWrapper").removeClass("blurry")});a.preventDefault()})});